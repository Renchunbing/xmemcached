<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

 


 
 
 


 <link rel="icon" type="image/vnd.microsoft.icon" href="phosting.ico">
 
 
 
 
 <title>User_Guide - 
 xmemcached -
 
 User Guide Version 0.3 - Project Hosting on Google Code</title>
 
 
 <meta name="ROBOTS" content="NOARCHIVE">
 
 
 
 
 
 
 
 <link type="application/atom+xml" rel="alternate" href="http://code.google.com/feeds/p/xmemcached/svnchanges/basic?path=/wiki/User_Guide.wiki">
 
 
<!--[if IE]>
 <link type="text/css" rel="stylesheet" href="http://www.gstatic.com/codesite/ph/18091280713519311357/css/d_ie.css" >
<![endif]-->
 

<link rel="stylesheet" type="text/css" href="index.css" media="all">
</head><body class="t6">
<div id="maincol" style="padding: 0pt 3px 3px 0pt; margin: 0pt;">
<div id="wikicontent">
<table width="100%" border="0" cellpadding="0" cellspacing="0">
<tbody>
<tr>
<td class="vt" id="wikimaincol" width="100%">
<!--DOCUMENT_FRAGMENT-->
<div id="wikiheader" style="margin-bottom: 1em;">
 <span style="font-size: 120%; font-weight: bold;">User_Guide</span>
 &nbsp;
 
 
 <div style="font-style: italic; margin-top: 3px;">User Guide Version 0.3</div>
 
 </div>
 <p></p><ul><li><a href="#Changes_History">Changes History</a></li><li><a href="#XMemcached_Introduction">XMemcached Introduction</a></li><li><a href="#XMemcached_Features">XMemcached Features</a></li><ul><li><a href="#High_performance">High performance</a></li><li><a href="#Binary_and_Text_protocol">Binary and Text protocol</a></li><li><a href="#Client_distribution">Client distribution</a></li><li><a href="#Weighted_server">Weighted server</a></li><li><a href="#Dynamically_add/remove_server">Dynamically add/remove server</a></li><li><a href="#JMX_Monitor/Control">JMX Monitor/Control</a></li><li><a href="#Integration_with_Spring_and_Hibernate-memcached">Integration with Spring and Hibernate-memcached</a></li><li><a href="#NIO_Connection_Pool">NIO Connection Pool</a></li><li><a href="#Expendable">Expendable</a></li></ul><li><a href="#User_Guide">User Guide</a></li><ul><li><a href="#Dependence">Dependence</a></li><li><a href="#If_you_use_maven">If you use maven</a></li><li><a href="#Simple_Example">Simple Example</a></li><li><a href="#Client_distribution">Client distribution</a></li><li><a href="#CAS_Operation">CAS Operation</a></li><li><a href="#More_Examples">More Examples</a></li><li><a href="#Iterate_all_keys">Iterate all keys</a></li><li><a href="#Incr/Decr">Incr/Decr</a></li><li><a href="#STAT._Information">STAT. Information</a></li><li><a href="#SASL_authentication">SASL authentication</a></li><li><a href="#Advance_Topic">Advance Topic</a></li><ul><li><a href="#Integration_with_Spring_Framework">Integration with Spring Framework</a></li><ul><li><a href="#Spring_3.0_and_Builder_Configuration">Spring 3.0 and Builder Configuration</a></li></ul><li><a href="#Weighted_Server">Weighted Server</a></li><li><a href="#Use_binary_protocol">Use binary protocol</a></li><li><a href="#JMX_Support">JMX Support</a></li><li><a href="#Dynamically_add/remove_server">Dynamically add/remove server</a></li><li><a href="#NIO_Connection_Pool">NIO Connection Pool</a></li><li><a href="#Talk_with_Kestrel">Talk with Kestrel</a></li><li><a href="#Talk_with_tokyotyrant">Talk with tokyotyrant</a></li><li><a href="#Integration_with_Hibernate-memcached">Integration with Hibernate-memcached</a></li><li><a href="#Compression%E3%80%81sanitizeKeys_and_misc.">Compression、sanitizeKeys and misc.</a></li><ul><li><a href="#Data_compression">Data compression</a></li><li><a href="#packZeros">packZeros</a></li><li><a href="#sanitizeKeys">sanitizeKeys</a></li></ul></ul></ul></ul> <h1><a name="Changes_History">Changes History</a><a href="#Changes_History" class="section_anchor">¶</a></h1><ul><li>2010-06-22  Add support for distributed client and SASL authentication,update Spring configuration document. </li><li>2010-06-23  Add document for maven dependence </li></ul><h1><a name="XMemcached_Introduction">XMemcached Introduction</a><a href="#XMemcached_Introduction" class="section_anchor">¶</a></h1><p>XMemcached is a new java memcached client. Maybe you don't know "memcached" so far, you can check <a href="http://code.google.com/p/memcached/" rel="nofollow">Here</a>. It is a free &amp; open source, high-performance, distributed memory object caching system, generic in nature, but intended for use in speeding up dynamic web applications by alleviating database load. And many users use it as memory database too. Memcached talk with client with self define protocol, XMemcached is a java client for it.  </p><p>There are two java clients before: the official client base on traditional blocked IO, maintained by <a href="http://www.whalin.com/memcached/" rel="nofollow">Greg Whalin</a>, the <a href="http://code.google.com/p/spymemcached" rel="nofollow">Spymemcached</a> based on java NIO, maintained by Dustin Sallings. And there are some improved version base on them too. So, what's advantage of XMemcached, why we need a new java client for Memcached?  </p><h1><a name="XMemcached_Features">XMemcached Features</a><a href="#XMemcached_Features" class="section_anchor">¶</a></h1><h2><a name="High_performance">High performance</a><a href="#High_performance" class="section_anchor">¶</a></h2><p>XMemcached is a client which base on java NIO too, Java NIO is efficient (special under high concurrent), and use less resource than traditional blocked IO. The traditional blocked IO need create some connections to build a connection pool for improve efficiency. But NIO only need one connection (sure, NIO also support pool management), reduce the cost for thread creation and switch, it is more obvious under hight concurrent. So the performance of XMemcached and Spymemcached are very excellent, and in some point, XMemcached is more excellent than Spymemcached, you can check <a href="http://xmemcached.googlecode.com/svn/trunk/benchmark/benchmark.html" rel="nofollow">Java Memcached Clients Benchmark</a> for details. </p><h2><a name="Binary_and_Text_protocol">Binary and Text protocol</a><a href="#Binary_and_Text_protocol" class="section_anchor">¶</a></h2><p>XMemcached support all protocols of memcached, also included <a href="http://code.google.com/p/memcached/wiki/MemcacheBinaryProtocol" rel="nofollow">Binary protocol</a> from Memcached 1.4.0. </p><h2><a name="Client_distribution">Client distribution</a><a href="#Client_distribution" class="section_anchor">¶</a></h2><p>Memcached supports distribution by client, and XMemcached implements it, and supply implement of consistent hash algorithm. </p><h2><a name="Weighted_server">Weighted server</a><a href="#Weighted_server" class="section_anchor">¶</a></h2><p>XMemcached can adjust weight of node for balance the load of memcached server, the weight is more high, the memcached server will store more data, and receive more load. </p><h2><a name="Dynamically_add/remove_server">Dynamically add/remove server</a><a href="#Dynamically_add/remove_server" class="section_anchor">¶</a></h2><p>XMemcached can dynamically add/remove server, by JMX or programming, it is easy to extend server or replace server. </p><h2><a name="JMX_Monitor/Control">JMX Monitor/Control</a><a href="#JMX_Monitor/Control" class="section_anchor">¶</a></h2><p>You can monitor or control XMemcached client by JMX, you can set some parameters, view the STAT. data, add or remove server etc. </p><h2><a name="Integration_with_Spring_and_Hibernate-memcached">Integration with Spring and Hibernate-memcached</a><a href="#Integration_with_Spring_and_Hibernate-memcached" class="section_anchor">¶</a></h2><p>Just like many projects, XMemcached also support integration with Spring framework. <a href="http://code.google.com/p/hibernate-memcached/" rel="nofollow">Hibernate-memcached</a> is a open source project, it can use memcached as secondary cache of hibernate, the default is Spymemcached, you can use XMemcached too. </p><h2><a name="NIO_Connection_Pool">NIO Connection Pool</a><a href="#NIO_Connection_Pool" class="section_anchor">¶</a></h2><p>As mentioned before, Java NIO will use one connection for one memcached server at most time, but XMemcached can also support connection pool. You can create a few connections to build a connection pool to one memcached server, it can improve the performance under high concurrent environment, and it is transparent to user. You must assure the data's independence or synchronization of data, there is no synchronization between connections to a server, you must make sure the data are all independent, or you can use CAS for atomic operation. </p><h2><a name="Expendable">Expendable</a><a href="#Expendable" class="section_anchor">¶</a></h2><p>XMemcached is implemented under java NIO framework<a href="http://code.google.com/p/yanf4j/" rel="nofollow">yanf4j</a>, with clear architecture. (yanf4j is combined into XMemcached after XMemcached 1.2.5). You can find the classes UML diagram of XMemcached here<img src="main.cld.jpg"> . </p><h1><a name="User_Guide">User Guide</a><a href="#User_Guide" class="section_anchor">¶</a></h1><p>We will show you some examples from simple to complex, then you can learn XMemcached easily. </p><h2><a name="Dependence">Dependence</a><a href="#Dependence" class="section_anchor">¶</a></h2><p>XMemcached depend on <a href="http://code.google.com/p/yanf4j/downloads/list" rel="nofollow">yanf4j</a> and <a href="http://www.slf4j.org/" rel="nofollow">slf4j</a>, and yanf4j is my another open source NIO framework.  </p><p><strong>Note: XMemcached is not depend on yanf4j since version 1.2.5.</strong> </p><ul><li>XMemcached 1.2.0 and 1.2.1L need yanf4j 1.0.1 </li></ul><ul><li>XMemcached 1.2.2 need yanf4j 1.1.0 </li></ul><ul><li>XMemcached 1.2.3 and 1.2.4 need yanf4j 1.1.1 </li></ul><p>You must download dependence or download whole XMemcached package with dependence before test following code. </p><h2><a name="If_you_use_maven">If you use maven</a><a href="#If_you_use_maven" class="section_anchor">¶</a></h2><p>If you build your project with maven, you can only add dependency to use XMemcached (only for 1.2.5+) </p><pre class="prettyprint"><span class="pln">&nbsp;</span><span class="tag">&lt;dependency&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp;</span><span class="tag">&lt;groupId&gt;</span><span class="pln">com.googlecode.xmemcached</span><span class="tag">&lt;/groupId&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp;</span><span class="tag">&lt;artifactId&gt;</span><span class="pln">xmemcached</span><span class="tag">&lt;/artifactId&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp;</span><span class="tag">&lt;version&gt;</span><span class="pln">1.2.5</span><span class="tag">&lt;/version&gt;</span><span class="pln"><br>&nbsp; </span><span class="tag">&lt;/dependency&gt;</span></pre><h2><a name="Simple_Example">Simple Example</a><a href="#Simple_Example" class="section_anchor">¶</a></h2><p>As the general user, you need to add/get data from memcached at most time. If we have a memcached server, the IP address or host name is "host", the service port is 11211, you can check this simple example: </p><pre class="prettyprint"><span class="pln">&nbsp; &nbsp; </span><span class="typ">MemcachedClientBuilder</span><span class="pln"> builder </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">XMemcachedClientBuilder</span><span class="pun">(</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="typ">AddrUtil</span><span class="pun">.</span><span class="pln">getAddresses</span><span class="pun">(</span><span class="str">"localhost:11211"</span><span class="pun">));</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="typ">MemcachedClient</span><span class="pln"> memcachedClient </span><span class="pun">=</span><span class="pln"> builder</span><span class="pun">.</span><span class="pln">build</span><span class="pun">();</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; memcachedClient</span><span class="pun">.</span><span class="kwd">set</span><span class="pun">(</span><span class="str">"hello"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Hello,xmemcached"</span><span class="pun">);</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="typ">String</span><span class="pln"> value </span><span class="pun">=</span><span class="pln"> memcachedClient</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="str">"hello"</span><span class="pun">);</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="typ">System</span><span class="pun">.</span><span class="kwd">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="str">"hello="</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> value</span><span class="pun">);</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; memcachedClient</span><span class="pun">.</span><span class="kwd">delete</span><span class="pun">(</span><span class="str">"hello"</span><span class="pun">);</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; value </span><span class="pun">=</span><span class="pln"> memcachedClient</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="str">"hello"</span><span class="pun">);</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="typ">System</span><span class="pun">.</span><span class="kwd">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="str">"hello="</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> value</span><span class="pun">);</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">MemcachedException</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="typ">System</span><span class="pun">.</span><span class="pln">err</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="str">"MemcachedClient operation fail"</span><span class="pun">);</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; e</span><span class="pun">.</span><span class="pln">printStackTrace</span><span class="pun">();</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">TimeoutException</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="typ">System</span><span class="pun">.</span><span class="pln">err</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="str">"MemcachedClient operation timeout"</span><span class="pun">);</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; e</span><span class="pun">.</span><span class="pln">printStackTrace</span><span class="pun">();</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">InterruptedException</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// ignore</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">//close memcached client</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; memcachedClient</span><span class="pun">.</span><span class="pln">shutdown</span><span class="pun">();</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">IOException</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="typ">System</span><span class="pun">.</span><span class="pln">err</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="str">"Shutdown MemcachedClient fail"</span><span class="pun">);</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; e</span><span class="pun">.</span><span class="pln">printStackTrace</span><span class="pun">();</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="pun">}</span></pre><p>Note: For save time, please import packages by yourself or by IDE. </p><p>Since XMemcachedClient has many options to create, there is a XMemcachedClientBuilder class to help build MemcachedClient<a href="http://code.google.com/p/xmemcached/w/edit/MemcachedClient">?</a>. The MemcachedClient<a href="http://code.google.com/p/xmemcached/w/edit/MemcachedClient">?</a> is a main interface, you can find almost methods in this class. XMemcachedClient is a implement of MemcachedClient<a href="http://code.google.com/p/xmemcached/w/edit/MemcachedClient">?</a>. </p><p>When you use XMemcachedClientBuilder, the parameter of memcached server list should be a string which just like <strong>"host1:port1 host2:port2 …"</strong> , the AddrUtil<a href="http://code.google.com/p/xmemcached/w/edit/AddrUtil">?</a>.getAddresses will get IP addresses list after parse it. </p><p>You can use "set" to store data, it has 3 parameters, the first is key name, the second is expire time (second), after the expire time, you can't find the key in memcached server. The third parameter is the data for store, it can be any java serialized object.  </p><p>You can use "get" with a key name for retrieve data. If you will remove stored data, you can use "delete" with a key. </p><p>Since XMemcached is based on NIO, so the process of communication is asynchronous, When the client send a request to memcached server, you can't know how long you will receive the response, client can only wait, so there is a concept of timeout. After send a request, the client will regard it is failed after some time if no response. The default timeout value is 1 second. The above example use default timeout time for all calls. If you need different timeout, you can use like this: </p><pre class="prettyprint"><span class="pln">&nbsp; &nbsp;value</span><span class="pun">=</span><span class="pln">client</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(“</span><span class="pln">hello</span><span class="pun">”,</span><span class="lit">3000</span><span class="pun">);</span></pre><p>It will timeout after 3 seconds, you will get a TimeoutException<a href="http://code.google.com/p/xmemcached/w/edit/TimeoutException">?</a> if no response in 3 second, you need handle the exception by your code. And you need handle InterruptException<a href="http://code.google.com/p/xmemcached/w/edit/InterruptException">?</a> too, because the method use CountDownLatch<a href="http://code.google.com/p/xmemcached/w/edit/CountDownLatch">?</a>.await(timeout) internally. And if MemcachedException<a href="http://code.google.com/p/xmemcached/w/edit/MemcachedException">?</a> occurred, it means some exceptions in XMemcached internal, just like encode/decode exception, or network failed. </p><h2><a name="Client_distribution">Client distribution</a><a href="#Client_distribution" class="section_anchor">¶</a></h2><p>The distribution of Memcached is implement by client side, Client will get a memcached server by hash of key, then store the value to the server. </p><p>XMemcached support client distribution strategy, the default strategy is <strong>Standard Hash</strong>: "hash(key) mod server_count", you need do nothing if use default strategy.   </p><p>XMemcached also support <a href="http://en.wikipedia.org/wiki/Consistent_hashing" rel="nofollow">Consistent Hash</a>, it need set by method:  </p><pre class="prettyprint"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="typ">MemcachedClientBuilder</span><span class="pln"> builder </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">XMemcachedClientBuilder</span><span class="pun">(</span><span class="typ">AddrUtil</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">.</span><span class="pln">getAddresses</span><span class="pun">(</span><span class="pln">properties</span><span class="pun">.</span><span class="pln">getProperty</span><span class="pun">(</span><span class="str">"test.memcached.servers"</span><span class="pun">))</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; builder</span><span class="pun">.</span><span class="pln">setSessionLocator</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">KetamaMemcachedSessionLocator</span><span class="pun">());</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="typ">MemcachedClient</span><span class="pln"> client</span><span class="pun">=</span><span class="pln">builder</span><span class="pun">.</span><span class="pln">build</span><span class="pun">();</span></pre><p>You can check "Integration with Spring Framework" for configuration. </p><p>XMemcached supply another hash algorithm -- Election Hash, you can use it in some case, just like: </p><pre class="prettyprint"><span class="pln">&nbsp; </span><span class="typ">MemcachedClientBuilder</span><span class="pln"> builder </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">XMemcachedClientBuilder</span><span class="pun">(</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="typ">AddrUtil</span><span class="pun">.</span><span class="pln">getAddresses</span><span class="pun">(</span><span class="str">"server1:11211 server2:11211 server3:11211"</span><span class="pun">));</span><span class="pln"><br>&nbsp; builder</span><span class="pun">.</span><span class="pln">setSessionLocator</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ElectionMemcachedSessionLocator</span><span class="pun">());</span><span class="pln"><br>&nbsp; </span><span class="typ">MemcachedClient</span><span class="pln"> mc </span><span class="pun">=</span><span class="pln"> builder</span><span class="pun">.</span><span class="pln">build</span><span class="pun">();</span></pre><h2><a name="CAS_Operation">CAS Operation</a><a href="#CAS_Operation" class="section_anchor">¶</a></h2><p>Memcached implement atomic update by CAS protocol, actually it is compare and set, the theory like Optimistic locking, it will bring a cas value when request to store a data, memcached will check the cas value with current cas value, it will overwrite old data if the value is same, otherwise it failed. It is very useful in concurrent environment. XMemcached support CAS protocol, whatever text protocol or binary protocol. CAS protocol has two steps: get CAS value and try update, so a typical use case should like:   </p><pre class="prettyprint"><span class="pln">&nbsp; </span><span class="typ">GetsResponse</span><span class="pun">&lt;</span><span class="typ">Integer</span><span class="pun">&gt;</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> client</span><span class="pun">.</span><span class="pln">gets</span><span class="pun">(</span><span class="str">"a"</span><span class="pun">);</span><span class="pln"><br>&nbsp; </span><span class="kwd">long</span><span class="pln"> cas </span><span class="pun">=</span><span class="pln"> result</span><span class="pun">.</span><span class="pln">getCas</span><span class="pun">();</span><span class="pln"> <br>&nbsp; </span><span class="com">//try update value of "a" to 2</span><span class="pln"><br>&nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">client</span><span class="pun">.</span><span class="pln">cas</span><span class="pun">(</span><span class="str">"a"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> cas</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="typ">System</span><span class="pun">.</span><span class="pln">err</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="str">"cas error"</span><span class="pun">);</span><span class="pln"><br>&nbsp; &nbsp;</span><span class="pun">}</span></pre><p>First you can get a GetsResponse<a href="http://code.google.com/p/xmemcached/w/edit/GetsResponse">?</a> by "gets" method, this object include the stored data and cas value, then try to update the value by "cas" method, it will print "cas error" if failed. Obvious, it is a little complicated. If you will try many atomic update you need a loop, so XMemcached supply a <strong>CASOperation</strong> interface to implement it, it allows you try N times to atomic update the data of the key, you don't need get cas value by call "gets" again, just like this: </p><pre class="prettyprint"><span class="pln">&nbsp;client</span><span class="pun">.</span><span class="pln">cas</span><span class="pun">(</span><span class="str">"a"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">CASOperation</span><span class="pun">&lt;</span><span class="typ">Integer</span><span class="pun">&gt;()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> getMaxTries</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> getNewValue</span><span class="pun">(</span><span class="kwd">long</span><span class="pln"> currentCAS</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> currentValue</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">});</span></pre><p>CASOperation interface only has two method, one method "getMaxTries" is used to set max try times, it is 1 time by default, if bigger than "Max Tries", it will throw a TimeoutException<a href="http://code.google.com/p/xmemcached/w/edit/TimeoutException">?</a>, if you will try more times, just set a big value; another method is "getNewValue", the returned value will be stored  if not failed, the parameters of this method are get from last GetsResponse<a href="http://code.google.com/p/xmemcached/w/edit/GetsResponse">?</a> result by call "gets". </p><h2><a name="More_Examples">More Examples</a><a href="#More_Examples" class="section_anchor">¶</a></h2><p>Here is more example, show how to call methods of MemcachedClient<a href="http://code.google.com/p/xmemcached/w/edit/MemcachedClient">?</a>:  </p><pre class="prettyprint"><span class="pln">&nbsp; </span><span class="typ">MemcachedClientBuilder</span><span class="pln"> builder </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">XMemcachedClientBuilder</span><span class="pun">(</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="typ">AddrUtil</span><span class="pun">.</span><span class="pln">getAddresses</span><span class="pun">(“</span><span class="pln">localhost</span><span class="pun">:</span><span class="lit">12000</span><span class="pun">”));</span><span class="pln"><br>&nbsp; </span><span class="typ">MemcachedClient</span><span class="pln"> client </span><span class="pun">=</span><span class="pln"> builder</span><span class="pun">.</span><span class="pln">build</span><span class="pun">();</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client</span><span class="pun">.</span><span class="pln">flushAll</span><span class="pun">();</span><span class="pln"><br>&nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">client</span><span class="pun">.</span><span class="kwd">set</span><span class="pun">(</span><span class="str">"hello"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="str">"world"</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="typ">System</span><span class="pun">.</span><span class="pln">err</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="str">"set error"</span><span class="pun">);</span><span class="pln"><br>&nbsp; </span><span class="pun">}</span><span class="pln"><br>&nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">client</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="str">"hello"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="str">"dennis"</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="typ">System</span><span class="pun">.</span><span class="pln">err</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="str">"Add error,key is existed"</span><span class="pun">);</span><span class="pln"><br>&nbsp; </span><span class="pun">}</span><span class="pln"><br>&nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">client</span><span class="pun">.</span><span class="pln">replace</span><span class="pun">(</span><span class="str">"hello"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="str">"dennis"</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="typ">System</span><span class="pun">.</span><span class="pln">err</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="str">"replace error"</span><span class="pun">);</span><span class="pln"><br>&nbsp; </span><span class="pun">}</span><span class="pln"><br>&nbsp; client</span><span class="pun">.</span><span class="pln">append</span><span class="pun">(</span><span class="str">"hello"</span><span class="pun">,</span><span class="pln"> </span><span class="str">" good"</span><span class="pun">);</span><span class="pln"><br>&nbsp; client</span><span class="pun">.</span><span class="pln">prepend</span><span class="pun">(</span><span class="str">"hello"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"hello "</span><span class="pun">);</span><span class="pln"><br>&nbsp; </span><span class="typ">String</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> client</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="str">"hello"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StringTranscoder</span><span class="pun">());</span><span class="pln"><br>&nbsp; </span><span class="typ">System</span><span class="pun">.</span><span class="kwd">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="pln">name</span><span class="pun">);</span><span class="pln"><br>&nbsp; client</span><span class="pun">.</span><span class="pln">deleteWithNoReply</span><span class="pun">(“</span><span class="pln">hello</span><span class="pun">”);</span></pre><p>First it store a "world" value by "hello" key, and call "add" and "replace", since the key exists, so "add" will failed, at same situation, "replace" will be ok, the value is updated to "dennis" from "world". Then we call append and prepend, append a " good" for the value, and insert "hello " before the value, then we can get the last value is "hello dennis good". And we call "deleteWithNoReply" to remove the data, this method will remove data and memcached will return nothing, so this method don't need wait the response, it is very good for batch operation. You will find xxxWithNoReply version for set/add/replace, please check API document for details. </p><h2><a name="Iterate_all_keys">Iterate all keys</a><a href="#Iterate_all_keys" class="section_anchor">¶</a></h2><p>Memcached is not supply a method to iterate all keys, but you can iterate all key by "stats items" and "stats cachedump" protocol, but is low performance, it is not recommended. XMemcached only support iterate in text protocol now. </p><p>If you want iterate all keys, you need retrieve a KeyIterator<a href="http://code.google.com/p/xmemcached/w/edit/KeyIterator">?</a>: </p><pre class="prettyprint"><span class="typ">MemcachedClient</span><span class="pln"> client</span><span class="pun">=...</span><span class="pln"><br></span><span class="typ">KeyIterator</span><span class="pln"> it</span><span class="pun">=</span><span class="pln">client</span><span class="pun">.</span><span class="pln">getKeyIterator</span><span class="pun">(</span><span class="typ">AddrUtil</span><span class="pun">.</span><span class="pln">getOneAddress</span><span class="pun">(</span><span class="str">"localhost:11211"</span><span class="pun">));</span><span class="pln"><br></span><span class="kwd">while</span><span class="pun">(</span><span class="pln">it</span><span class="pun">.</span><span class="pln">hasNext</span><span class="pun">())</span><span class="pln"><br></span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp;</span><span class="typ">String</span><span class="pln"> key</span><span class="pun">=</span><span class="pln">it</span><span class="pun">.</span><span class="kwd">next</span><span class="pun">();</span><span class="pln"><br></span><span class="pun">}</span></pre><h2><a name="Incr/Decr">Incr/Decr</a><a href="#Incr/Decr" class="section_anchor">¶</a></h2><p>The following code show you how to use incr/decr, these two operations are like AtomicInteger<a href="http://code.google.com/p/xmemcached/w/edit/AtomicInteger">?</a> class in java, for increase and decrease atomically: </p><pre class="prettyprint"><span class="pln">&nbsp;</span><span class="kwd">assert</span><span class="pun">(</span><span class="lit">1</span><span class="pun">==</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">memcachedClient</span><span class="pun">.</span><span class="pln">incr</span><span class="pun">(</span><span class="str">"a"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">));</span><span class="pln"><br>&nbsp;</span><span class="kwd">assert</span><span class="pun">(</span><span class="lit">6</span><span class="pun">==</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">memcachedClient</span><span class="pun">.</span><span class="pln">incr</span><span class="pun">(</span><span class="str">"a"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">));</span><span class="pln"><br>&nbsp;</span><span class="kwd">assert</span><span class="pun">(</span><span class="lit">10</span><span class="pun">==</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">memcachedClient</span><span class="pun">.</span><span class="pln">incr</span><span class="pun">(</span><span class="str">"a"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">));</span><span class="pln"><br>&nbsp;</span><span class="kwd">assert</span><span class="pun">(</span><span class="lit">9</span><span class="pun">==</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">memcachedClient</span><span class="pun">.</span><span class="pln">decr</span><span class="pun">(</span><span class="str">"a"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">));</span><span class="pln"><br>&nbsp;</span><span class="kwd">assert</span><span class="pun">(</span><span class="lit">7</span><span class="pun">==</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">memcachedClient</span><span class="pun">.</span><span class="pln">deccr</span><span class="pun">(</span><span class="str">"a"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">));</span></pre><p>"incr" and "decr" both have method with 3 parameters, the first is the key name, the second is step, the third is default value if key is not exist. and them have method with 2 parameters too, the third parameter is removed, it will use "0" as default value. </p><p>XMemcached also supply a Counter class, it packing the incr/decr method, you can use it just like AtomicInteger<a href="http://code.google.com/p/xmemcached/w/edit/AtomicInteger">?</a>: </p><pre class="prettyprint"><span class="pln">&nbsp; </span><span class="typ">Counter</span><span class="pln"> counter</span><span class="pun">=</span><span class="pln">client</span><span class="pun">.</span><span class="pln">getCounter</span><span class="pun">(</span><span class="str">"counter"</span><span class="pun">,</span><span class="lit">0</span><span class="pun">);</span><span class="pln"><br>&nbsp; counter</span><span class="pun">.</span><span class="pln">incrementAndGet</span><span class="pun">();</span><span class="pln"><br>&nbsp; counter</span><span class="pun">.</span><span class="pln">decrementAndGet</span><span class="pun">();</span><span class="pln"><br>&nbsp; counter</span><span class="pun">.</span><span class="pln">addAndGet</span><span class="pun">(-</span><span class="lit">10</span><span class="pun">);</span></pre><p>The second parameter is for initial value for counter. </p><h2><a name="STAT._Information">STAT. Information</a><a href="#STAT._Information" class="section_anchor">¶</a></h2><p>Memcached supply protocol for view stat. information.   </p><pre class="prettyprint"><span class="pln">&nbsp; &nbsp;</span><span class="typ">Map</span><span class="pun">&lt;</span><span class="typ">InetSocketAddress</span><span class="pun">,</span><span class="typ">Map</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span class="typ">String</span><span class="pun">&gt;&gt;</span><span class="pln"> result</span><span class="pun">=</span><span class="pln">client</span><span class="pun">.</span><span class="pln">getStats</span><span class="pun">();</span></pre><p>getStats method will return a map, it stored all stat. data of all active memcached servers, you can stat special data, e.g. "items": </p><pre class="prettyprint"><span class="pln">&nbsp; &nbsp;</span><span class="typ">Map</span><span class="pun">&lt;</span><span class="typ">InetSocketAddress</span><span class="pun">,</span><span class="typ">Map</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span class="typ">String</span><span class="pun">&gt;&gt;</span><span class="pln"> result</span><span class="pun">=</span><span class="pln">client</span><span class="pun">.</span><span class="pln">getStatsByItem</span><span class="pun">(</span><span class="str">"items"</span><span class="pun">);</span></pre><p>You only need set the parameter value by the name (items, sizes, slabs). </p><h2><a name="SASL_authentication">SASL authentication</a><a href="#SASL_authentication" class="section_anchor">¶</a></h2><p>Memcached 1.4.3 start to support client SASL authentication, after enable SASL in server side, client need authentication with server, otherwise will be denied. XMemcached support this feature since 1.2.5. Assume memcached server enable the SASL authentication, use "cacheuser" as user name, use "123456" as password, you need access Memcached like this: </p><pre class="prettyprint"><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="typ">MemcachedClientBuilder</span><span class="pln"> builder </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">XMemcachedClientBuilder</span><span class="pun">(</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="typ">AddrUtil</span><span class="pun">.</span><span class="pln">getAddresses</span><span class="pun">(</span><span class="str">"localhost:11211"</span><span class="pun">));</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; builder</span><span class="pun">.</span><span class="pln">addAuthInfo</span><span class="pun">(</span><span class="typ">AddrUtil</span><span class="pun">.</span><span class="pln">getOneAddress</span><span class="pun">(</span><span class="str">"localhost:11211"</span><span class="pun">),</span><span class="pln"> </span><span class="typ">AuthInfo</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">.</span><span class="pln">typical</span><span class="pun">(</span><span class="str">"cacheuser"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"123456"</span><span class="pun">));</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// Must use binary protocol</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; builder</span><span class="pun">.</span><span class="pln">setCommandFactory</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">BinaryCommandFactory</span><span class="pun">());</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="typ">MemcachedClient</span><span class="pln"> client</span><span class="pun">=</span><span class="pln">builder</span><span class="pun">.</span><span class="pln">build</span><span class="pun">();</span></pre><p>Note: SASL authentication only support binary protocol. </p><p>If you will use Spring configuration, please check "Integration with Spring Framework" chapter. </p><h2><a name="Advance_Topic">Advance Topic</a><a href="#Advance_Topic" class="section_anchor">¶</a></h2><h3><a name="Integration_with_Spring_Framework">Integration with Spring Framework</a><a href="#Integration_with_Spring_Framework" class="section_anchor">¶</a></h3><p>You can use XMemcachedClientFactoryBean class, it can work with Spring, just like: </p><pre class="prettyprint"><span class="tag">&lt;bean</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"memcachedClient"</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"net.rubyeye.xmemcached.utils.XMemcachedClientFactoryBean"</span><span class="pln"> </span><span class="atn">destroy-method</span><span class="pun">=</span><span class="atv">"shutdown"</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"servers"</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;value&gt;</span><span class="pln">host1:port1 host2:port2</span><span class="tag">&lt;/value&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/property&gt;</span><span class="pln"><br>&nbsp; &nbsp;</span><span class="tag">&lt;/bean&gt;</span></pre><p>Then you can use the bean when you need it. </p><p>The following is more configuration in Spring Configuration File, include protocol, consistent hash, weighted server, connection pool, even included SASL authentication (Since XMemcached 1.2.5). </p><pre class="prettyprint"><span class="tag">&lt;bean</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"server1"</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"java.net.InetSocketAddress"</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;constructor-arg&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;value&gt;</span><span class="pln">host1</span><span class="tag">&lt;/value&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/constructor-arg&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;constructor-arg&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;value&gt;</span><span class="pln">port1</span><span class="tag">&lt;/value&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/constructor-arg&gt;</span><span class="pln"><br></span><span class="tag">&lt;/bean&gt;</span><span class="pln"><br><br></span><span class="tag">&lt;bean</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"memcachedClient"</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"net.rubyeye.xmemcached.utils.XMemcachedClientFactoryBean"</span><span class="pln"> </span><span class="atn">destroy-method</span><span class="pun">=</span><span class="atv">"shutdown"</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"servers"</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;value&gt;</span><span class="pln">host1:port1 host2:port2 host3:port3</span><span class="tag">&lt;/value&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/property&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">&lt;!-- server's weights --&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"weights"</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;list&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;value&gt;</span><span class="pln">1</span><span class="tag">&lt;/value&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;value&gt;</span><span class="pln">2</span><span class="tag">&lt;/value&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;value&gt;</span><span class="pln">3</span><span class="tag">&lt;/value&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/list&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/property&gt;</span><span class="pln"><br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">&lt;!-- AuthInfo map,only valid on 1.2.5 or later version --&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"authInfoMap"</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;map&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;entry</span><span class="pln"> </span><span class="atn">key-ref</span><span class="pun">=</span><span class="atv">"server1"</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;bean</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"net.rubyeye.xmemcached.auth.AuthInfo"</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="atn">factory-method</span><span class="pun">=</span><span class="atv">"typical"</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;constructor-arg</span><span class="pln"> </span><span class="atn">index</span><span class="pun">=</span><span class="atv">"0"</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;value&gt;</span><span class="pln">cacheuser</span><span class="tag">&lt;/value&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/constructor-arg&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;constructor-arg</span><span class="pln"> </span><span class="atn">index</span><span class="pun">=</span><span class="atv">"1"</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;value&gt;</span><span class="pln">123456</span><span class="tag">&lt;/value&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/constructor-arg&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/bean&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/entry&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/map&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/property&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">&lt;!-- NIO connection pool size --&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"connectionPoolSize"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"2"</span><span class="tag">&gt;&lt;/property&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com">&lt;!-- Use binary protocol, default is TextCommandFactory --&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"commandFactory"</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="tag">&lt;bean</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"net.rubyeye.xmemcached.command.BinaryCommandFactory"</span><span class="tag">&gt;&lt;/bean&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/property&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">&lt;!-- Distributed strategy --&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"sessionLocator"</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;bean</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"net.rubyeye.xmemcached.impl.KetamaMemcachedSessionLocator"</span><span class="tag">&gt;&lt;/bean&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/property&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">&lt;!-- Serializing transcoder --&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"transcoder"</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;bean</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"net.rubyeye.xmemcached.transcoders.SerializingTranscoder"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/property&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com">&lt;!-- ByteBuffer allocator --&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"bufferAllocator"</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;bean</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"net.rubyeye.xmemcached.buffer.SimpleBufferAllocator"</span><span class="tag">&gt;&lt;/bean&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/property&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/bean&gt;</span></pre><p>Parameters List: </p><p></p><table><tbody><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> Property Name </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> Value </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> servers </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> Memcached Server List: host1:port1 host2:port2 </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;">weights </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;">Weight of servers, more high weight, more connections </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> authInfoMap </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> authentication information, only avaiable for XMemcached 1.2.5+ </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> connectionPoolSize </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> NIO connection pool size, default 1  </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;">commandFactory </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;">protocol factory, net.rubyeye.xmemcached.command.BinaryCommandFactory<a href="http://code.google.com/p/xmemcached/w/edit/BinaryCommandFactory">?</a>,TextCommandFactory<a href="http://code.google.com/p/xmemcached/w/edit/TextCommandFactory">?</a> (default),KestrelCommandFactory<a href="http://code.google.com/p/xmemcached/w/edit/KestrelCommandFactory">?</a> </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> sessionLocator </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> distributed strategy,consitent hash: net.rubyeye.xmemcached.impl.KetamaMemcachedSessionLocator<a href="http://code.google.com/p/xmemcached/w/edit/KetamaMemcachedSessionLocator">?</a> or ArraySessionLocator<a href="http://code.google.com/p/xmemcached/w/edit/ArraySessionLocator">?</a>(default) </td></tr> </tbody></table><p></p><table><tbody><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;">transcoder </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> serlize transcoder, use net.rubyeye.xmemcached.transcoders.SerializingTranscoder<a href="http://code.google.com/p/xmemcached/w/edit/SerializingTranscoder">?</a> by default, more details please checkjavadoc </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> bufferAllocator </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> IoBuffer<a href="http://code.google.com/p/xmemcached/w/edit/IoBuffer">?</a> allocator, use net.rubyeye.xmemcached.buffer.SimpleBufferAllocator<a href="http://code.google.com/p/xmemcached/w/edit/SimpleBufferAllocator">?</a> by default,also support CachedBufferAllocator<a href="http://code.google.com/p/xmemcached/w/edit/CachedBufferAllocator">?</a>(not recommended now) </td></tr> </tbody></table><h4><a name="Spring_3.0_and_Builder_Configuration">Spring 3.0 and Builder Configuration</a><a href="#Spring_3.0_and_Builder_Configuration" class="section_anchor">¶</a></h4><p>Spring 3.0 use a different way to find "destroy" method, so if you just use above configuration, you will got a exception when start, the message  will this: "Couldn't find a destroy method named 'shutdown' on bean", then XMemcached can't work in such situation, and Spring IOC container can't start too. Any solution? sure, you can create MemcachedClient<a href="http://code.google.com/p/xmemcached/w/edit/MemcachedClient">?</a> by factory method in XmemcachedClientBuilder<a href="http://code.google.com/p/xmemcached/w/edit/XmemcachedClientBuilder">?</a>, here is a example: </p><pre class="prettyprint"><span class="pln">&nbsp; &nbsp;</span><span class="tag">&lt;bean</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"memcachedClientBuilder"</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"net.rubyeye.xmemcached.XMemcachedClientBuilder"</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">&lt;!-- XMemcachedClientBuilder have two arguments.First is server list,and second is weights array. --&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;constructor-arg&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;list&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;bean</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"java.net.InetSocketAddress"</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;constructor-arg&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;value&gt;</span><span class="pln">localhost</span><span class="tag">&lt;/value&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/constructor-arg&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;constructor-arg&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;value&gt;</span><span class="pln">12000</span><span class="tag">&lt;/value&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/constructor-arg&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/bean&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;bean</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"java.net.InetSocketAddress"</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;constructor-arg&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;value&gt;</span><span class="pln">localhost</span><span class="tag">&lt;/value&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/constructor-arg&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;constructor-arg&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;value&gt;</span><span class="pln">12001</span><span class="tag">&lt;/value&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/constructor-arg&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/bean&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/list&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/constructor-arg&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;constructor-arg&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;list&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;value&gt;</span><span class="pln">1</span><span class="tag">&lt;/value&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;value&gt;</span><span class="pln">2</span><span class="tag">&lt;/value&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/list&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/constructor-arg&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"authInfoMap"</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;map&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;entry</span><span class="pln"> </span><span class="atn">key-ref</span><span class="pun">=</span><span class="atv">"server1"</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;bean</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"net.rubyeye.xmemcached.auth.AuthInfo"</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="atn">factory-method</span><span class="pun">=</span><span class="atv">"typical"</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;constructor-arg</span><span class="pln"> </span><span class="atn">index</span><span class="pun">=</span><span class="atv">"0"</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;value&gt;</span><span class="pln">cacheuser</span><span class="tag">&lt;/value&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/constructor-arg&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;constructor-arg</span><span class="pln"> </span><span class="atn">index</span><span class="pun">=</span><span class="atv">"1"</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;value&gt;</span><span class="pln">123456</span><span class="tag">&lt;/value&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/constructor-arg&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/bean&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/entry&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/map&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/property&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"connectionPoolSize"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"2"</span><span class="tag">&gt;&lt;/property&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"commandFactory"</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;bean</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"net.rubyeye.xmemcached.command.TextCommandFactory"</span><span class="tag">&gt;&lt;/bean&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/property&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"sessionLocator"</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;bean</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"net.rubyeye.xmemcached.impl.KetamaMemcachedSessionLocator"</span><span class="tag">&gt;&lt;/bean&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/property&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"transcoder"</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;bean</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"net.rubyeye.xmemcached.transcoders.SerializingTranscoder"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/property&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;/bean&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">&lt;!-- Use factory bean to build memcached client --&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;bean</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"memcachedClient3"</span><span class="pln"> </span><span class="atn">factory-bean</span><span class="pun">=</span><span class="atv">"memcachedClientBuilder"</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="atn">factory-method</span><span class="pun">=</span><span class="atv">"build"</span><span class="pln"> </span><span class="atn">destroy-method</span><span class="pun">=</span><span class="atv">"shutdown"</span><span class="tag">/&gt;</span></pre><h3><a name="Weighted_Server">Weighted Server</a><a href="#Weighted_Server" class="section_anchor">¶</a></h3><p>If you use spring, please check above chapter. If you will set it by programming, here it is: </p><pre class="prettyprint"><span class="pln">&nbsp;</span><span class="typ">MemcachedClientBuilder</span><span class="pln"> builder </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> &nbsp; &nbsp; <br></span><span class="typ">XMemcachedClientBuilder</span><span class="pun">(</span><span class="typ">AddrUtil</span><span class="pun">.</span><span class="pln">getAddresses</span><span class="pun">(</span><span class="str">"localhost:12000 localhost:12001"</span><span class="pun">),</span><span class="kwd">new</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">[]{</span><span class="lit">1</span><span class="pun">,</span><span class="lit">3</span><span class="pun">});</span><span class="pln"><br>&nbsp; &nbsp;</span><span class="typ">MemcachedClient</span><span class="pln"> memcachedClient</span><span class="pun">=</span><span class="pln">builder</span><span class="pun">.</span><span class="pln">build</span><span class="pun">();</span></pre><p>It passes into an int array, the value is for the weight of server, so you can see the weight is 1 for "localhost:12000" server, and the weight is 3 for "localhost:12001" server. And you should know the weight of XMemcached is implement by connection counte, you will find 3 connections if the weight is 3, MemcachedSessionLocator<a href="http://code.google.com/p/xmemcached/w/edit/MemcachedSessionLocator">?</a> will find them in connection session list. </p><p>You can update the weight for one server, use setServerWeight:  </p><pre class="prettyprint"><span class="pln">&nbsp;</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">XMemcachedClientMBean</span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="pun">....</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com">/**<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* Set a memcached server's weight<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* @param server<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;* @param weight<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*/</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setServerWeight</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> server</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> weight</span><span class="pun">);</span><span class="pln"><br>&nbsp; &nbsp;</span><span class="pun">}</span></pre><h3><a name="Use_binary_protocol">Use binary protocol</a><a href="#Use_binary_protocol" class="section_anchor">¶</a></h3><p>If you use spring, please check "Integration with Spring Framework" chapter. </p><p>Memcached support binary protocol from version 1.4, XMemcached support binary protocol from version 1.2. It is simple to enable this feature, just set CommandFactory<a href="http://code.google.com/p/xmemcached/w/edit/CommandFactory">?</a>: </p><pre class="prettyprint"><span class="typ">MemcachedClientBuilder</span><span class="pln"> builder </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> &nbsp; &nbsp;</span><span class="typ">XMemcachedClientBuilder</span><span class="pun">(</span><span class="typ">AddrUtil</span><span class="pun">.</span><span class="pln">getAddresses</span><span class="pun">(</span><span class="str">"localhost:12000 localhost:12001"</span><span class="pun">),</span><span class="kwd">new</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">[]{</span><span class="lit">1</span><span class="pun">,</span><span class="lit">3</span><span class="pun">});</span><span class="pln"><br>&nbsp; &nbsp;builder</span><span class="pun">.</span><span class="pln">setCommandFactory</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">BinaryCommandFactory</span><span class="pun">());</span><span class="com">//use binary protocol </span><span class="pln"><br>&nbsp; &nbsp;</span><span class="typ">MemcachedClient</span><span class="pln"> memcachedClient</span><span class="pun">=</span><span class="pln">builder</span><span class="pun">.</span><span class="pln">build</span><span class="pun">();</span></pre><p>The default protocol use TextCommandFactory<a href="http://code.google.com/p/xmemcached/w/edit/TextCommandFactory">?</a> for Text Protocol. </p><h3><a name="JMX_Support">JMX Support</a><a href="#JMX_Support" class="section_anchor">¶</a></h3><p>You can monitor XMemcached by JMX, you need add some options when you start jvm: </p><pre class="prettyprint"><span class="pln">&nbsp;java </span><span class="pun">-</span><span class="typ">Dxmemcached</span><span class="pun">.</span><span class="pln">jmx</span><span class="pun">.</span><span class="pln">enable</span><span class="pun">=</span><span class="kwd">true</span></pre><p>XMemcached exposes service by RMI: </p><pre class="prettyprint"><span class="pln">&nbsp;service</span><span class="pun">:</span><span class="pln">jmx</span><span class="pun">:</span><span class="pln">rmi</span><span class="pun">:</span><span class="com">///jndi/rmi://[host]:7077/xmemcachedServer </span></pre><p>And you can check these MBean by jconsole. </p><p>It includes following MBeans: </p><table><tbody><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> MBean </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> Description </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;">net.rubyeye.xmemcached.monitor.StatisticsHandlerMBean </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> for Stat. Information of Client </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;">net.rubyeye.xmemcached.impl.OptimizerMBean </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> for adjust performance option </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;">net.rubyeye.xmemcached.XMemcachedClientMBean </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> dynamically add/remove server, list avaiable servers</td></tr> </tbody></table><p>More JMX Options: </p><table><tbody><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> Option </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> Description</td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;">-Dxmemcached.rmi.port </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> RMI port </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;">-Dxmemcached.rmi.name </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> RMI service name </td></tr> </tbody></table><h3><a name="Dynamically_add/remove_server">Dynamically add/remove server</a><a href="#Dynamically_add/remove_server" class="section_anchor">¶</a></h3><p>You can use JMX to do it, or by programming: </p><pre class="prettyprint"><span class="pln">&nbsp; &nbsp; </span><span class="typ">MemcachedClient</span><span class="pln"> client</span><span class="pun">=</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">XMemcachedClient</span><span class="pun">(</span><span class="typ">AddrUtil</span><span class="pun">.</span><span class="pln">getAddresses</span><span class="pun">(</span><span class="str">"server1:11211 server2:11211"</span><span class="pun">));</span><span class="pln"><br>&nbsp; &nbsp;</span><span class="com">//Add two new memcached nodes</span><span class="pln"><br>&nbsp; &nbsp;client</span><span class="pun">.</span><span class="pln">addServer</span><span class="pun">(</span><span class="str">"server3:11211 server4:11211"</span><span class="pun">);</span><span class="pln"><br>&nbsp; &nbsp;</span><span class="com">//Remove memcached servers</span><span class="pln"><br>&nbsp; &nbsp;client</span><span class="pun">.</span><span class="pln">removeServer</span><span class="pun">(</span><span class="str">"server1:11211 server2:11211"</span><span class="pun">);</span></pre><h3><a name="NIO_Connection_Pool">NIO Connection Pool</a><a href="#NIO_Connection_Pool" class="section_anchor">¶</a></h3><p>XMemcached is base on java NIO, it has one connection to one Memcached server by default, it is very excellent in most projects. But in some typical high-concurrent enviornment, it will has bottleneck too. So Xmemcached support NIO connection pool, it can create multiple connections to one Memcached server. But you should know, they are not synchronized, so you must make sure the synchronzation of data update. You can enable connection pool with following code: </p><pre class="prettyprint"><span class="pln">&nbsp; </span><span class="typ">MemcachedClientBuilder</span><span class="pln"> builder </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> &nbsp; &nbsp;</span><span class="typ">XMemcachedClientBuilder</span><span class="pun">(</span><span class="typ">AddrUtil</span><span class="pun">.</span><span class="pln">getAddresses</span><span class="pun">(</span><span class="str">"localhost:12000"</span><span class="pun">));</span><span class="pln"><br><br>&nbsp; builder</span><span class="pun">.</span><span class="pln">setConnectionPoolSize</span><span class="pun">(</span><span class="lit">5</span><span class="pun">);</span></pre><p>If you use spring, please check "Integration with Spring Framework" chapter. </p><h3><a name="Talk_with_Kestrel">Talk with Kestrel</a><a href="#Talk_with_Kestrel" class="section_anchor">¶</a></h3><p>Kestrel is a open source project by twitter by scala language, it is a simple and high-performance MQ. It support Memcached text protocol, but not full compatibled, e.g. it can't support flag, so many client can't work since they use flag for serlization. XMemcached support a KestrelCommandFactory<a href="http://code.google.com/p/xmemcached/w/edit/KestrelCommandFactory">?</a> to support Kestrel. With KestrelCommandFactory<a href="http://code.google.com/p/xmemcached/w/edit/KestrelCommandFactory">?</a> you can: </p><ul><li>close get with multiple keys, because Kestrel doesn't support bulk get. </li></ul><ul><li>support Blocking Fetch and Reliable Fetch of Kestrel. </li></ul><ul><li>support store any java serializable type. </li></ul><p>Use KestrelCommandFactory<a href="http://code.google.com/p/xmemcached/w/edit/KestrelCommandFactory">?</a> like this: </p><pre class="prettyprint"><span class="pln">&nbsp;</span><span class="typ">MemcachedClientBuilder</span><span class="pln"> builder </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">XMemcachedClientBuilder</span><span class="pun">(</span><span class="typ">AddrUtil</span><span class="pun">.</span><span class="pln">getAddresses</span><span class="pun">(</span><span class="str">"localhost:12000 localhost:12001"</span><span class="pun">),</span><span class="kwd">new</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">[]{</span><span class="lit">1</span><span class="pun">,</span><span class="lit">3</span><span class="pun">});</span><span class="pln"><br>&nbsp; &nbsp;builder</span><span class="pun">.</span><span class="pln">setCommandFactory</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">KestrelCommandFactory</span><span class="pun">());</span><span class="pln"><br>&nbsp; &nbsp;</span><span class="typ">MemcachedClient</span><span class="pln"> memcachedClient</span><span class="pun">=</span><span class="pln">builder</span><span class="pun">.</span><span class="pln">build</span><span class="pun">();</span></pre><p>You should note, since Kestrel doesn't support flag, so XMemcached append 4 bytes as flag before stored data, if all your application use XMemcached, it is fine, but if you will use other client, maybe it will not work again, so you can turn of  this feature by: </p><pre class="prettyprint"><span class="pln">client</span><span class="pun">.</span><span class="pln">setPrimitiveAsString</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">);</span></pre><p>After set it to true, all the primitive type will be stored as string, but you can' store serializable type now.   </p><h3><a name="Talk_with_tokyotyrant">Talk with tokyotyrant</a><a href="#Talk_with_tokyotyrant" class="section_anchor">¶</a></h3><p>You can talk with TokyoTyrant<a href="http://code.google.com/p/xmemcached/w/edit/TokyoTyrant">?</a> by TokyoTyrantTranscoder<a href="http://code.google.com/p/xmemcached/w/edit/TokyoTyrantTranscoder">?</a>, but TokyoTyrant<a href="http://code.google.com/p/xmemcached/w/edit/TokyoTyrant">?</a> doesn't support flag/exptime in memcached text protocol, so TokyoTyrantTranscoder<a href="http://code.google.com/p/xmemcached/w/edit/TokyoTyrantTranscoder">?</a> append 4 bytes before value as flag, if all your application use XMemcached, it is fine, but if you will use other client, maybe it will not compatibled, just like talk with Kestrel. </p><pre class="prettyprint"><span class="pln">&nbsp;</span><span class="typ">MemcachedClientBuilder</span><span class="pln"> builder </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> &nbsp; &nbsp;</span><span class="typ">XMemcachedClientBuilder</span><span class="pun">(</span><span class="typ">AddrUtil</span><span class="pun">.</span><span class="pln">getAddresses</span><span class="pun">(</span><span class="str">"localhost:12000 localhost:12001"</span><span class="pun">),</span><span class="kwd">new</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">[]{</span><span class="lit">1</span><span class="pun">,</span><span class="lit">3</span><span class="pun">});</span><span class="pln"><br>&nbsp; &nbsp;builder</span><span class="pun">.</span><span class="pln">setTranscoder</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">TokyoTyrantTranscoder</span><span class="pun">());</span><span class="pln"><br>&nbsp; &nbsp;</span><span class="typ">MemcachedClient</span><span class="pln"> memcachedClient</span><span class="pun">=</span><span class="pln">builder</span><span class="pun">.</span><span class="pln">build</span><span class="pun">();</span></pre><h3><a name="Integration_with_Hibernate-memcached">Integration with Hibernate-memcached</a><a href="#Integration_with_Hibernate-memcached" class="section_anchor">¶</a></h3><p>Like use spymemcahed, you can check wiki of hibernate-memcached, if use XMemcached, first you need set memcacheClientFactory to XmemcachedClientFactory<a href="http://code.google.com/p/xmemcached/w/edit/XmemcachedClientFactory">?</a>. </p><p></p><table><tbody><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <strong>Property</strong> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <strong>Value</strong> </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;">hibernate.memcached.memcacheClientFactory </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> net.rubyeye.xmemcached.utils.hibernate.XmemcachedClientFactory<a href="http://code.google.com/p/xmemcached/w/edit/XmemcachedClientFactory">?</a> </td></tr> </tbody></table><p>And please note other properties, they have many difference:  </p><p></p><table><tbody><tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <strong>Property</strong> </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> <strong>Value</strong> </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;">hibernate.memcached.servers </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> localhost:11211 localhost:11212</td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;">ibernate.memcached.cacheTimeSeconds </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> 300</td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;">hibernate.memcached.keyStrategy    </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> HashCodeKeyStrategy<a href="http://code.google.com/p/xmemcached/w/edit/HashCodeKeyStrategy">?</a> </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;">hibernate.memcached.readBufferSize </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;">DEFAULT_SESSION_READ_BUFF_SIZE </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;">hibernate.memcached.operationTimeout </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;">DEFAULT_OP_TIMEOUT </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;">hibernate.memcached.hashAlgorithm  </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> NATIVE_HASH,KETAMA_HASH etc.</td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;">hibernate.memcached.commandFactory </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> TextCommandFactory<a href="http://code.google.com/p/xmemcached/w/edit/TextCommandFactory">?</a> , BinaryCommandFactory<a href="http://code.google.com/p/xmemcached/w/edit/BinaryCommandFactory">?</a> </td></tr> <tr><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;">hiberante.memcached.sessionLocator </td><td style="border: 1px solid rgb(170, 170, 170); padding: 5px;"> ArrayMemcachedSessionLocator<a href="http://code.google.com/p/xmemcached/w/edit/ArrayMemcachedSessionLocator">?</a>,KetamaMemcachedSessionLocator<a href="http://code.google.com/p/xmemcached/w/edit/KetamaMemcachedSessionLocator">?</a></td></tr> </tbody></table><h3><a name="Compression、sanitizeKeys_and_misc.">Compression、sanitizeKeys and misc.</a><a href="#Compression%E3%80%81sanitizeKeys_and_misc." class="section_anchor">¶</a></h3><h4><a name="Data_compression">Data compression</a><a href="#Data_compression" class="section_anchor">¶</a></h4><p>Memcached is inefficient when you store large data, XMemcached will help you compress large data, and auto uncompress and deserilize data when you retrieve the data, the Threshold is 16K by default, you can set the threshold by setCompressionThreshold in Transcoder interface, you can set it to 1K: </p><pre class="prettyprint"><span class="pln">memcachedClient</span><span class="pun">.</span><span class="pln">getTranscoder</span><span class="pun">()).</span><span class="pln">setCompressionThreshold</span><span class="pun">(</span><span class="lit">1024</span><span class="pun">);</span></pre><p>This method is introduced since version 1.2.1, you can do it by this before version 1.2.1: </p><pre class="prettyprint"><span class="pln">&nbsp;</span><span class="pun">((</span><span class="typ">SerializingTranscoder</span><span class="pun">)</span><span class="pln">memcachedClient</span><span class="pun">.</span><span class="pln">getTranscoder</span><span class="pun">()).</span><span class="pln">setCompressionThreshold</span><span class="pun">(</span><span class="lit">1024</span><span class="pun">);</span></pre><h4><a name="packZeros">packZeros</a><a href="#packZeros" class="section_anchor">¶</a></h4><p>There is a special process when XMemcached serialize number type, There prefix zeors will be removed, the data will more smaller. For example the number "3" will be serialized into "0x0003", it will convert into  "0x3" after process. And it will append zeros when deserialization by the number type automaticlly. The feature is turned on by default, you can turn it off for compatibility. </p><pre class="prettyprint"><span class="pln">memcachedClient</span><span class="pun">.</span><span class="pln">getTranscoder</span><span class="pun">()).</span><span class="pln">setPackZeros</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">);</span></pre><h4><a name="sanitizeKeys">sanitizeKeys</a><a href="#sanitizeKeys" class="section_anchor">¶</a></h4><p>There is a "sanitizeKeys" option in offical client, when you use URL as the key, MemcachedClient<a href="http://code.google.com/p/xmemcached/w/edit/MemcachedClient">?</a> will encode the URL before store. It is off by default, you can enable it by: </p><pre class="prettyprint"><span class="pln">&nbsp;memcachedClient</span><span class="pun">.</span><span class="pln">setSanitizeKeys</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">);</span></pre><p>This feature is introducted since version 1.2.1. </p>
<!--/DOCUMENT_FRAGMENT-->
</td>
</tr>
</tbody>
</table>
</div>
</div>
</body></html>
